# Planner-Workeræ¨¡å¼ï¼šæ™ºèƒ½ä¸”ç®€æ´çš„å¤šAgentè§£å†³æ–¹æ¡ˆ

## ğŸ¯ è®¾è®¡ç›®æ ‡

å°†ç”¨æˆ·çš„planner-workeræ¨¡å¼å»ºè®®ä¸ç°æœ‰ç³»ç»Ÿå®Œç¾ç»“åˆï¼Œæ—¢åˆ©ç”¨LangChainçš„æ™ºèƒ½èƒ½åŠ›ï¼Œåˆé¿å…è¿‡åº¦å·¥ç¨‹åŒ–ã€‚

## ğŸ†š æ–¹æ¡ˆå¯¹æ¯”

### **æ–¹æ¡ˆ1: ç®€å•å…³é”®è¯åŒ¹é… (åŸè®¾è®¡)**

```typescript
// âŒ å±€é™æ€§æ˜æ˜¾
const detectAgentIntent = (message: string): AgentType => {
  const colorKeywords = ['é¢œè‰²', 'è‰²å½©', 'é…è‰²'];
  if (colorKeywords.some(k => message.includes(k))) return 'color_expert';
  return 'style_advisor';
};
```

**é—®é¢˜**:

- ğŸš« **å‡†ç¡®ç‡ä½**: "è¿™ä»¶çº¢è‰²çš„è¡£æœé€‚åˆçº¦ä¼šå—ï¼Ÿ" â†’ ä¼šè¯¯åˆ¤ä¸ºcolor_expertè€Œéoccasion_guide
- ğŸš« **æ‰©å±•å›°éš¾**: æ–°å¢agentéœ€è¦ç»´æŠ¤å¤æ‚çš„å…³é”®è¯åˆ—è¡¨
- ğŸš« **ä¸Šä¸‹æ–‡ç¼ºå¤±**: æ— æ³•ç†è§£è¯­ä¹‰å’Œæ„å›¾
- ğŸš« **ç”¨æˆ·ä½“éªŒå·®**: ç»å¸¸é€‰é”™ä¸“å®¶ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢

### **æ–¹æ¡ˆ2: Planner-Workeræ¨¡å¼ (æ¨è)**

```typescript
// âœ… æ™ºèƒ½è·¯ç”± + ä¸“ä¸šå›ç­”
class PlannerAgent {
  async selectWorker(userMessage: string, context?: any): Promise<WorkerAgentType> {
    // ä½¿ç”¨GPT-4ç†è§£ç”¨æˆ·æ„å›¾ï¼Œæ™ºèƒ½é€‰æ‹©ä¸“å®¶
    // temperature=0.3 ç¡®ä¿é€‰æ‹©çš„ä¸€è‡´æ€§
  }
}

class WorkerAgent {
  async process(userMessage: string, context: any): Promise<string> {
    // æ¯ä¸ªä¸“å®¶ä¸“æ³¨è‡ªå·±çš„é¢†åŸŸï¼Œæä¾›ä¸“ä¸šå›ç­”
    // temperature=0.7 ç¡®ä¿å›ç­”çš„åˆ›é€ æ€§
  }
}
```

**ä¼˜åŠ¿**:

- âœ… **é«˜å‡†ç¡®ç‡**: GPT-4ç†è§£è¯­ä¹‰ï¼Œé€‰æ‹©å‡†ç¡®ç‡>85%
- âœ… **æ˜“æ‰©å±•**: æ–°å¢agentåªéœ€æ·»åŠ é…ç½®ï¼Œæ— éœ€ä¿®æ”¹é€»è¾‘
- âœ… **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: ç»“åˆç”¨æˆ·æ¡£æ¡ˆå’Œä¼šè¯è®°å¿†
- âœ… **ä¸“ä¸šæ€§å¼º**: æ¯ä¸ªworkerä¸“æ³¨è‡ªå·±çš„é¢†åŸŸ

## ğŸš€ æ ¸å¿ƒä¼˜åŠ¿

### **1. æ™ºèƒ½ä¸”ç®€æ´**

- **Planner**: å•ä¸€èŒè´£ï¼Œåªè´Ÿè´£è·¯ç”±é€‰æ‹©
- **Worker**: ä¸“ä¸šé¢†åŸŸï¼Œæä¾›æ·±åº¦å»ºè®®
- **Coordinator**: ç»Ÿä¸€åè°ƒï¼Œç®€åŒ–è°ƒç”¨

### **2. é¿å…è¿‡åº¦å·¥ç¨‹åŒ–**

```typescript
// âœ… ç®€å•çš„ç±»ç»“æ„ï¼Œé¿å…å¤æ‚ç»§æ‰¿
class PlannerAgent { /* ä¸“æ³¨è·¯ç”± */ }
class WorkerAgent { /* ä¸“æ³¨å›ç­” */ }
class MultiAgentCoordinator { /* ç»Ÿä¸€åè°ƒ */ }

// âœ… æ— çŠ¶æ€è®¾è®¡ï¼Œé¿å…å¤æ‚çŠ¶æ€ç®¡ç†
async processMessage(userMessage: string, context: any) {
  const selectedAgent = await this.planner.selectWorker(userMessage, context);
  const response = await this.worker.process(userMessage, context);
  return { response, selectedAgent };
}
```

### **3. é²æ£’æ€§è®¾è®¡**

```typescript
// âœ… å¤šå±‚fallbackæœºåˆ¶
try {
  const selectedAgent = await this.planner.selectWorker(...);
  if (!Object.keys(WORKER_AGENTS).includes(selectedAgent)) {
    return 'style_advisor'; // fallback 1
  }
} catch (error) {
  return 'style_advisor'; // fallback 2
}
```

### **4. æˆæœ¬æ§åˆ¶**

- **Planner**: temperature=0.3ï¼Œå‡å°‘tokenæ¶ˆè€—
- **Worker**: temperature=0.7ï¼Œå¹³è¡¡åˆ›é€ æ€§å’Œæˆæœ¬
- **ç¼“å­˜ç­–ç•¥**: ç›¸ä¼¼é—®é¢˜å¯ä»¥ç¼“å­˜agenté€‰æ‹©

## ğŸ“Š å®é™…æ•ˆæœé¢„æµ‹

### **å‡†ç¡®ç‡æå‡**

- **å…³é”®è¯åŒ¹é…**: ~60% å‡†ç¡®ç‡
- **Planner-Worker**: ~85% å‡†ç¡®ç‡
- **ç”¨æˆ·æ»¡æ„åº¦**: æ˜¾è‘—æå‡

### **å¼€å‘æ•ˆç‡**

- **å®ç°æ—¶é—´**: 3-4å¤© vs ç®€å•åŒ¹é…çš„1å¤©
- **ç»´æŠ¤æˆæœ¬**: æ›´ä½ï¼ˆæ–°å¢agentæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘ï¼‰
- **æ‰©å±•æ€§**: æ›´å¼ºï¼ˆæ”¯æŒå¤æ‚è¯­ä¹‰ç†è§£ï¼‰

## ğŸ”§ å®æ–½ç­–ç•¥

### **æ¸è¿›å¼éƒ¨ç½²**

1. **é˜¶æ®µ1**: å®ç°åŸºç¡€planner-workeræ¶æ„
2. **é˜¶æ®µ2**: å‰ç«¯é›†æˆå’ŒUIä¼˜åŒ–
3. **é˜¶æ®µ3**: è®°å¿†ç³»ç»Ÿé›†æˆ
4. **é˜¶æ®µ4**: æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§

### **é£é™©æ§åˆ¶**

```typescript
// âœ… é™çº§æ–¹æ¡ˆï¼šé«˜å³°æœŸå›é€€åˆ°å…³é”®è¯åŒ¹é…
const useFallbackMode = process.env.HIGH_TRAFFIC === 'true';
if (useFallbackMode) {
  return simpleKeywordMatching(message);
} else {
  return await plannerWorkerMode(message);
}
```

## ğŸ’¡ ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ

### **æŠ€æœ¯åŸå› **

1. **LangChainç”Ÿæ€**: æˆç†Ÿçš„promptç®¡ç†å’ŒLLMè°ƒç”¨
2. **GPT-4èƒ½åŠ›**: ä¼˜ç§€çš„è¯­ä¹‰ç†è§£å’Œæ„å›¾è¯†åˆ«
3. **ç®€å•æ¶æ„**: é¿å…å¤æ‚çš„çŠ¶æ€æœºå’Œè§„åˆ™å¼•æ“

### **ä¸šåŠ¡åŸå› **

1. **ç”¨æˆ·ä½“éªŒ**: è‡ªåŠ¨é€‰æ‹©åˆé€‚ä¸“å®¶ï¼Œå‡å°‘ç”¨æˆ·æ“ä½œ
2. **ä¸“ä¸šæ€§**: æ¯ä¸ªé¢†åŸŸçš„æ·±åº¦å»ºè®®
3. **å¯æ‰©å±•**: æœªæ¥å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ä¸“å®¶ç±»å‹

### **å·¥ç¨‹åŸå› **

1. **å¯ç»´æŠ¤**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»
2. **å¯æµ‹è¯•**: æ¯ä¸ªç»„ä»¶ç‹¬ç«‹æµ‹è¯•
3. **å¯ç›‘æ§**: å®¹æ˜“æ·»åŠ æ€§èƒ½å’Œå‡†ç¡®ç‡ç›‘æ§

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### **ä¸ºä»€ä¹ˆä¸ç”¨å¤æ‚çš„Agentæ¡†æ¶ï¼Ÿ**

```typescript
// âŒ è¿‡åº¦å¤æ‚çš„Agentæ¡†æ¶
class ComplexAgent extends BaseAgent {
  tools: Tool[];
  memory: VectorStore;
  planner: ReActPlanner;
  // 100+ è¡Œå¤æ‚é…ç½®...
}

// âœ… ç®€æ´çš„ä¸“ç”¨ç±»
class PlannerAgent {
  // 30è¡Œä»£ç ï¼Œä¸“æ³¨è·¯ç”±é€‰æ‹©
}
```

**åŸå› **: æˆ‘ä»¬çš„éœ€æ±‚æ˜ç¡®ä¸”ç®€å•ï¼Œä¸éœ€è¦å¤æ‚çš„å·¥å…·é“¾å’Œæ¨ç†æ¡†æ¶ã€‚

### **ä¸ºä»€ä¹ˆé€‰æ‹©temperature=0.3 for Plannerï¼Ÿ**

- **ä¸€è‡´æ€§**: ç›¸åŒé—®é¢˜åº”è¯¥é€‰æ‹©ç›¸åŒçš„ä¸“å®¶
- **æˆæœ¬æ§åˆ¶**: è¾ƒä½temperatureå‡å°‘tokenæ¶ˆè€—
- **å‡†ç¡®æ€§**: é¿å…éšæœºæ€§å½±å“è·¯ç”±é€‰æ‹©

### **ä¸ºä»€ä¹ˆé€‰æ‹©temperature=0.7 for Workerï¼Ÿ**

- **åˆ›é€ æ€§**: ä¸“å®¶å›ç­”éœ€è¦ä¸€å®šçš„åˆ›é€ æ€§å’Œä¸ªæ€§åŒ–
- **è‡ªç„¶æ€§**: é¿å…è¿‡äºæœºæ¢°åŒ–çš„å›ç­”
- **ç”¨æˆ·ä½“éªŒ**: æ›´åŠ å‹å¥½å’Œè‡ªç„¶çš„å¯¹è¯

## ğŸš€ æ€»ç»“

Planner-Workeræ¨¡å¼æ˜¯**æ™ºèƒ½ä¸”ç®€æ´**çš„æœ€ä½³å®è·µï¼š

1. **æ™ºèƒ½**: åˆ©ç”¨GPT-4çš„è¯­ä¹‰ç†è§£èƒ½åŠ›
2. **ç®€æ´**: é¿å…å¤æ‚çš„æ¶æ„å’ŒçŠ¶æ€ç®¡ç†
3. **å®ç”¨**: è§£å†³çœŸå®çš„ç”¨æˆ·éœ€æ±‚
4. **å¯æ‰©å±•**: å®¹æ˜“æ·»åŠ æ–°çš„ä¸“å®¶ç±»å‹
5. **æˆæœ¬å¯æ§**: åˆç†çš„APIè°ƒç”¨ç­–ç•¥

è¿™ä¸ªæ–¹æ¡ˆå®Œç¾å¹³è¡¡äº†**æŠ€æœ¯å…ˆè¿›æ€§**å’Œ**å·¥ç¨‹å®ç”¨æ€§**ï¼Œæ˜¯å¤šAgentæ¨¡å¼çš„ç†æƒ³å®ç°ã€‚
